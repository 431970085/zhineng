<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>圆环图</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <style>
        #myEcharts02 {
            width: 800px;
            height: 500px;
            /*border: solid 1px red;*/
            margin: 50px auto;

        }
    </style>
    <script src="../static/js/vue.js"></script>
    <script src="../static/js/axios.min.js"></script>
    <script src="../request.js"></script>
    <script src="../static/echarts/jquery.3.6.0.min.js"></script>
    <script src="../static/echarts/echarts.5.0.2.js"></script>
    <style>
        #myEcharts02 {
            width: 800px;
            height: 500px;
            /*border: solid 1px red;*/
            margin: 50px auto;

        }
    </style>
</head>
<body>
<div class="layui-container">


    <!--为echarts准备一个dom容器-->
    <div id="myEcharts02"></div>
    <script>

        //请求路径
        var url = ctx + "/selectAction";
        //执行的sql语句
        var sql = " select sex as name,count(*) as val from userinfo  GROUP BY sex ";
        //初始化echarts实例
        //柱状图
        function getpieChart() {
            var pieData = [];
            var legendData = [];
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                data: {"sql": sql},
                cache: false,
                success: function (data) {
                    var data = data.data;
                    for (let j = 0; j < data.length; j++) {
                        var value = data[j].val;
                        var name = data[j].name;
                        var o = {value: parseInt(value), name: name};
                        pieData.push(o);
                        legendData.push(name);
                    }
                    console.log(pieData);
                    console.log(legendData);
                    //饼图
                    var pieChart = echarts.init(document.getElementById("myEcharts02"));
                    var pieoption = {
                        title: {
                            text: '用户性别统计',
                            x: 'center',
                            y: '0px',
                            textStyle: {
                                color: '#3A7BD5',
                                fontSize: 20
                            },
                            textAlign: 'left'
                        },
                        tooltip: {
                            trigger: 'item'
                        },
                        toolbox: {
                            show: true,
                            feature: {
                                mark: {show: true},
                                dataView: {show: true, readOnly: false},
                                magicType: {
                                    show: true,
                                    type: ['pie', 'funnel'],
                                    option: {
                                        funnel: {
                                            x: '25%',
                                            width: '50%',
                                            funnelAlign: 'left',
                                            max: 1548
                                        }
                                    }
                                },
                                restore: {show: true},
                                saveAsImage: {show: true}
                            }
                        },
                        legend: {
                            top: '5%',
                            left: 'center'
                        },
                        series: [
                            {
                                name: '圆环图',
                                type: 'pie',
                                radius: ['40%', '70%'],
                                avoidLabelOverlap: false,
                                itemStyle: {
                                    borderRadius: 10,
                                    borderColor: '#fff',
                                    borderWidth: 2
                                },
                                label: {
                                    show: false,
                                    position: 'center'
                                },
                                emphasis: {
                                    label: {
                                        show: true,
                                        fontSize: 40,
                                        fontWeight: 'bold'
                                    }
                                },
                                labelLine: {
                                    show: false
                                },
                                data: pieData
                            }
                        ]
                    };
                    pieChart.setOption(pieoption);
                    $(window).resize(pieChart.resize);

                },
                error: function (responseStr) {
                    alert("数据类模板数量查询失败！");
                }
            });


        }


        $(function () {
            //加载饼图
            getpieChart();
        });
    </script>
</div>
</body>
</html>
